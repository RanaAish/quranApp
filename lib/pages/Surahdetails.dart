import 'package:flutter/material.dart';import 'package:alquran_alkarim/utils/themes/colors.dart';import 'package:alquran_alkarim/utils/thmes/text.style.dart';import 'package:responsive_builder/responsive_builder.dart';import 'package:alquran_alkarim/widgets/Begin_surah_card.dart';import 'package:alquran_alkarim/widgets/Actions_on_Aya.dart';import 'package:alquran_alkarim/widgets/ArabicAya.dart';import 'package:hive/hive.dart';import 'package:alquran_alkarim/providers/sheikh.dart';import 'package:provider/provider.dart';import 'package:alquran_alkarim/services/Quran_services.dart';import 'package:scroll_to_index/scroll_to_index.dart';import 'package:alquran_alkarim/providers/bookmark.dart';import 'package:alquran_alkarim/providers/setting.dart';import 'package:provider/provider.dart';import 'package:alquran_alkarim/utils/themes/themes.dart';// TODO :: HOME PAGEclass Surahdetails extends StatefulWidget {  static String id = "Surahdetails";  @override  _SurahdetailsState createState() => _SurahdetailsState();}class _SurahdetailsState extends State<Surahdetails> {  Box arabicayabox,englishayabox;  QuranApi quran = QuranApi();  Future<List> DATA;  bool issearching=false;  bool check ,checktype;  List searchitems =[];  int i;  TextEditingController searchcontroller =new TextEditingController();  final scrollDirection = Axis.vertical;  AutoScrollController controller;  filttersurah()  {    if(searchcontroller.text.isNotEmpty)    {      var filteredsurah;      RegExp exp = new RegExp("^[a-zA-Z0-9]*");      exp.allMatches(searchcontroller.text).forEach((match) {        if (match.group(0)!= "") {          for(var aya in englishayabox.get(i).ayahs)          if(aya.text.contains(searchcontroller.text))            {              filteredsurah.add(aya);            }          setState(() {            checktype=false;          });        }        else        {          filteredsurah =arabicayabox.values              .where((surah) =>surah.name.contains(searchcontroller.text))              .toList();          setState(() {            checktype=true;          });        }      });      setState(() {        searchitems=filteredsurah;      });    }  }  clearingdata()async  {    await arabicayabox.clear();  }  @override  void initState() {    // TODO: implement initState    arabicayabox = Hive.box('arabicaya');    englishayabox=Hive.box('englishaya');    if(Provider.of<sheikh>(context,listen: false).change)      {        updateaudio();      }    searchcontroller.addListener(() {      filttersurah();    });    controller = AutoScrollController(        viewportBoundaryGetter: () =>            Rect.fromLTRB(0, 0, 0, MediaQuery.of(context).padding.bottom),        axis: scrollDirection);  //  _scrollToIndex();    super.initState();  }  updateaudio () async{    int numberaya =0;    await Hive.openBox('arabicaya').then((item){      if (!item.isEmpty) {        print('empty');        setState(() {          for(int j=0;j<item.length;j++)          {            var i = item.get(j);            for (int k=0;k<i.ayahs.length;k++)            {              i.ayahs[k].audio="https://cdn.alquran.cloud/media/audio/ayah/${Provider.of<sheikh>(context,listen: false).name}/${i.ayahs[k].number}";            }          }        });      }    });  }  @override  Widget build(BuildContext context) {    final shiekh= Provider.of<sheikh>(context,listen: false);    final theme= Provider.of<SettingsProvider>(context);    check=searchcontroller.text.isNotEmpty;    setState(() {      i=ModalRoute.of(context).settings.arguments;    });    return FutureBuilder(        future: Hive.openBox('arabicaya'),        builder: (context, snapshot) {          if (snapshot.hasData) {            final obj_from_box=arabicayabox.get(i);            final object_from_englishbox =englishayabox.get(i);            _scrollToIndex(obj_from_box.number);            return Scaffold(                appBar: AppBar(                  backgroundColor:theme.gettheme()==AppThemes.dark?Colors.black45:CustomColors.kwhite,                  elevation: 0,                  actions: [                    issearching?                    new IconButton(                      onPressed: (){                        searchcontroller.clear();                        setState(() {                          this.issearching=false;                        });                      },                      icon: Icon(                        Icons.cancel,                        color: CustomColors.kSecondaryGreyColor,                      ),                    ): new IconButton(                      onPressed: (){                        setState(() {                          searchcontroller.clear();                          this.issearching=true;                        });                      },                      icon: Icon(                        Icons.search,                        color: CustomColors.kSecondaryGreyColor,                      ),                    ),                  ],                  title:!issearching ?Text(obj_from_box.name,                      style:theme.gettheme()==AppThemes.dark?AppTextStyles.appBarEnglishTextdark:AppTextStyles.appBarEnglishText):TextField(style: TextStyle(color:theme.gettheme()==AppThemes.dark?Colors.white                      : Colors.black),                    decoration: InputDecoration(hintText: "Search Surah Here",hintStyle:                    TextStyle(color: Colors.black)),controller:searchcontroller ,),                  leading: IconButton(                    onPressed: () {                      Navigator.of(context).pop();                    },                    icon: Icon(                      Icons.arrow_back,                      color: CustomColors.kSecondaryGreyColor,                    ),                  ),                ),               // backgroundColor: CustomColors.kwhite,                body: ResponsiveBuilder(                    builder: (context, sizingInformation) =>                    SingleChildScrollView(                 child: Column(          crossAxisAlignment: CrossAxisAlignment.start,                      children: [                        Begin_surah_card(                          name:obj_from_box.name,                          englishName:                          obj_from_box.englishName.toString(),                          englishNameTranslation:                          obj_from_box.englishNameTranslation,                          revelationType:                          obj_from_box.revelationType.toString(),                          numberOfAyahs:                          obj_from_box.ayahs.length.toString(),                        ),                        Container(                            padding: EdgeInsets.all(25),                            child: Expanded(                                child: SizedBox(                                    height: 380.0,                                    child: ListView.builder(                                        scrollDirection: scrollDirection,                                        controller: controller,                                        shrinkWrap: true,                                        itemCount:obj_from_box.ayahs.length,                                        itemBuilder: (BuildContext context,                                            int index) {                                            return AutoScrollTag(                                                key: ValueKey(index),                                          controller: controller,                                          index: object_from_englishbox.ayahs[index].number,                                          child:Container(child:                                            Column(                                              children: [                                                Actions_on_Aya(                                                  url: obj_from_box.ayahs                                                  [index].audio                                                      .toString(),arabicaya: obj_from_box.ayahs                                                [index].text.toString() ,englishaya: object_from_englishbox.ayahs                                                [index].text.toString(),                                                  lengthofayahs: object_from_englishbox.ayahs.length,                                                  number: object_from_englishbox.ayahs[index].number,                                                  surahnumber:obj_from_box.number ,                                                ),                                                SizedBox(                                                  height: sizingInformation                                                      .screenSize.height *                                                      .03,                                                ),                                                Aya(                                                  text:obj_from_box.ayahs                                                  [index].text                                                      .toString(),alignment: Alignment.topRight,index: 1,                                                ),                                                SizedBox(                                                  height: sizingInformation                                                      .screenSize.height *                                                      .02,                                                ),                                                FutureBuilder(                                                    future:Hive.openBox('englishaya'),                                                    builder:                                                        (context, snapshot2) {                                                      //  final obj_from_englishbox=check?searchitems[i]:englishayabox.get(i);                                                      return                                                        Aya(                                                          text: object_from_englishbox.ayahs[index].text.toString(),alignment: Alignment.topLeft,index: 1,);                                                    }),                                                SizedBox(                                                  height: sizingInformation                                                      .screenSize.height *                                                      .02,                                                ),                                                Divider()                                              ],                                            ),));}                                        )))),                      ],                    ))));          } else {            return Center(child: new CircularProgressIndicator());          }        });  }  Future _scrollToIndex(int surah) async {    if( Provider.of<bookmark>(context, listen: false).surahaudioindex==surah)      {        await controller.scrollToIndex( Provider.of<bookmark>(context, listen: false).pageaudioindex, preferPosition:AutoScrollPosition.begin);      }  }}